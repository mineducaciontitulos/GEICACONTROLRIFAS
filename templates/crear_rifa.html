{% extends "base.html" %}
{% block content %}

<style>
  /* ===== Scope solo para esta vista ===== */
  .crear-rifa .glass{
    background: rgba(255,255,255,.055);
    border: 2px solid rgba(255,255,255,.14);
    border-radius: 14px;
    box-shadow: 0 10px 28px rgba(0,0,0,.22), 0 0 0 2px rgba(255,214,0,.10) inset;
  }

  @media (max-width: 576px){
    .crear-rifa .btn-back{ width:100%; }
  }

  .crear-rifa .form-label{ font-weight:600; letter-spacing:.2px; white-space:nowrap; }
  .crear-rifa .form-control,
  .crear-rifa .form-select{
    color:#eef3ff;
    background: rgba(255,255,255,.10);
    border:1px solid rgba(255,255,255,.28);
    border-radius:12px;
    min-height:44px;
  }
  .crear-rifa .form-control::placeholder{ color:rgba(233,239,255,.65); }
  .crear-rifa .form-control:focus,
  .crear-rifa .form-select:focus{
    border-color:#3b82f6;
    box-shadow:0 0 0 .25rem rgba(59,130,246,.25);
  }

  /* El desplegable del select legible */
  .crear-rifa select.form-select,
  .crear-rifa select.form-select option{ color:#0f172a; background:#ffffff; }
  .crear-rifa select.form-select { color:#eef3ff; background:rgba(255,255,255,.10); }

  .crear-rifa .btn-success{
    background: linear-gradient(45deg,#22c55e,#16a34a);
    border:none;
    border-radius:12px;
    box-shadow:0 6px 18px rgba(34,197,94,.35);
  }
  .crear-rifa .btn-success:hover{
    transform:translateY(-1px);
    box-shadow:0 10px 24px rgba(34,197,94,.5);
  }

  .crear-rifa .preview-wrap{
    width:100%;
    min-height:140px;
    display:flex; align-items:center; justify-content:center;
    border:2px dashed rgba(255,255,255,.25);
    border-radius:12px;
    background:linear-gradient(135deg,
              rgba(255,0,150,.07),
              rgba(0,204,255,.07),
              rgba(255,255,0,.07));
  }
  .crear-rifa #preview{
    max-height:160px; border-radius:10px;
    border:2px solid rgba(255,255,255,.25);
    box-shadow:0 10px 20px rgba(0,0,0,.25);
  }
</style>

<div class="container py-4 crear-rifa">

  <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
    <h2 class="m-0">üéüÔ∏è Crear Nueva Rifa</h2>
    <a href="{{ url_for('panel') }}" class="btn btn-outline-secondary btn-back">‚¨ÖÔ∏è Volver al Panel</a>
  </div>

  <form class="glass p-4" action="{{ url_for('crear_rifa') }}" method="POST" enctype="multipart/form-data">
    <div class="row g-3">

      <!-- NOMBRE -->
      <div class="col-12 col-md-6">
        <label class="form-label">T√≠tulo *</label>
        <input class="form-control" name="nombre" required placeholder="Moto Yamaha FZ 2.0">
      </div>

      <!-- AVAL√öO -->
      <div class="col-6 col-md-3">
        <label class="form-label">Aval√∫o (COP)</label>
        <input type="number" class="form-control" name="avaluo" min="0" step="1000" placeholder="15000000">
      </div>

      <!-- LOTER√çA -->
      <div class="col-6 col-md-3">
        <label class="form-label">Loter√≠a *</label>
        <input class="form-control" name="nombre_loteria" required placeholder="Loter√≠a de Bogot√°">
      </div>

      <!-- FECHA/HORA DEL SORTEO -->
      <div class="col-12 col-md-4">
        <label class="form-label">Sorteo (fecha y hora)</label>
        <input type="datetime-local" class="form-control" name="fecha_fin" id="fecha_fin">
        <small class="text-secondary d-block mt-1">Al pasar esta fecha, la rifa se ocultar√° del panel de activas.</small>
      </div>

      <!-- CIFRAS -->
      <div class="col-12 col-md-4">
        <label class="form-label">Cifras *</label>
        <select class="form-select" name="cifras" id="cifras" required>
          <option value="2" selected>2 (00‚Äì99)</option>
          <option value="3">3 (000‚Äì999)</option>
          <option value="4">4 (0000‚Äì9999)</option>
        </select>
        <small class="text-secondary d-block mt-1">Con 2 cifras, la cantidad ser√° 100 fija.</small>
      </div>

      <!-- CANTIDAD -->
      <div class="col-12 col-md-4">
        <label class="form-label">Cantidad *</label>
        <input type="number" class="form-control" name="cantidad_numeros" id="cantidad" min="1" value="100" required>
      </div>

      <!-- VALOR N¬∫ -->
      <div class="col-12 col-md-4">
        <label class="form-label">Precio N¬∫ (COP) *</label>
        <input type="number" class="form-control" name="valor_numero" min="1000" step="500" required placeholder="10000">
      </div>

      <!-- DESCRIPCI√ìN (fila completa para que no se deforme) -->
      <div class="col-12">
        <label class="form-label">Descripci√≥n *</label>
        <textarea class="form-control" name="descripcion" rows="3" required placeholder="Modelo, color, condiciones, entrega..."></textarea>
      </div>

      <!-- IMAGEN -->
      <div class="col-12 col-md-6">
        <label class="form-label">Imagen del premio</label>
        <input type="file" class="form-control" name="imagen_premio" accept="image/*" id="imagen">
        <small class="text-secondary">Opcional (JPG/PNG/WEBP).</small>
      </div>

      <!-- PREVIEW -->
      <div class="col-12 col-md-6 d-flex align-items-end">
        <div class="preview-wrap w-100">
          <img id="preview" alt="Vista previa" class="d-none">
        </div>
      </div>

    </div>

    <div class="d-flex justify-content-end gap-2 mt-4">
      <button type="submit" class="btn btn-success">‚úÖ Crear Rifa</button>
    </div>
  </form>

</div>

<script>
  // Fijar cantidad=100 cuando son 2 cifras
  const sel = document.getElementById('cifras');
  const cant = document.getElementById('cantidad');
  const syncCantidad = () => {
    if (sel.value === '2') { cant.value = 100; cant.readOnly = true; }
    else { cant.readOnly = false; }
  };
  sel.addEventListener('change', syncCantidad);
  syncCantidad();

  // Preview imagen
  const inputImg = document.getElementById('imagen');
  const preview = document.getElementById('preview');
  inputImg?.addEventListener('change', (e) => {
    const f = e.target.files?.[0];
    if (!f) { preview.classList.add('d-none'); return; }
    const url = URL.createObjectURL(f);
    preview.src = url;
    preview.classList.remove('d-none');
  });

  // Sugerir m√≠nima fecha ahora (para evitar errores)
  const ffin = document.getElementById('fecha_fin');
  if (ffin){
    const pad = n => String(n).padStart(2,'0');
    const d = new Date();
    const iso = `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
    ffin.min = iso;
  }
</script>

{% endblock %}