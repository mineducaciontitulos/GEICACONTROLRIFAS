{% extends "base.html" %}
{% block content %}
<style>
  /* Botones con colores de la bandera de Colombia */
  .btn-amarillo { background-color: #FFD600; color: #000 !important; border: none; }
  .btn-azul { background-color: #0033A0; color: #fff !important; border: none; }
  .btn-rojo { background-color: #D50000; color: #fff !important; border: none; }
  .btn-blanco { background-color: #F5F5F5; color: #000 !important; border: none; }
  .btn-verde { background-color: #00A859; color: #fff !important; border: none; }

  .btn-amarillo:hover { background-color: #e6c200; color: #000 !important; }
  .btn-azul:hover { background-color: #002680; color: #fff !important; }
  .btn-rojo:hover { background-color: #b00000; color: #fff !important; }
  .btn-blanco:hover { background-color: #e0e0e0; color: #000 !important; }
  .btn-verde:hover { background-color: #008f4b; color: #fff !important; }

  /* Sombra y borde elegante para los bloques */
  .glass, .card-stat, .table {
    border: 1px solid rgba(255,255,255,0.1);
    box-shadow: 0px 0px 12px rgba(255, 214, 0, 0.3); /* toque dorado */
    border-radius: 10px;
  }
</style>

<div class="container py-4">

  <!-- Header + acciones -->
  <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
    <h2 class="m-0" style="line-height:1.25;">Panel ‚Äî {{ negocio["nombre_negocio"] }}</h2>
    <div class="d-flex flex-wrap gap-2">
      <a class="btn btn-amarillo" href="{{ url_for('crear_rifa') }}">+ Crear Rifa</a>
      <a class="btn btn-azul" href="{{ url_for('actualizar_rifas') }}">‚úé Actualizar Rifas</a>
      <a class="btn btn-rojo" href="{{ url_for('ver_rifas') }}">üìã Ver Rifas</a>
      <a class="btn btn-blanco" href="{{ url_for('notificar_ganador') }}">üèÜ Notificar Ganador</a>
      <a class="btn btn-verde" href="{{ url_for('logout') }}">‚õî Cerrar Sesi√≥n</a>
    </div>
  </div>

  <!-- Mensaje de bienvenida -->
  <div class="glass p-4 mb-4">
    <p class="mb-0 text-secondary">
      Bienvenido, <strong>{{ negocio["nombre_negocio"] }}</strong>. Aqu√≠ ver√°s y gestionar√°s tus rifas.
    </p>
  </div>

  <!-- Cards de estado -->
  <div class="row g-3 mb-4">
    {% set total = (rifas | sum(attribute='total')) if rifas else 0 %}
    {% set vendidos = (rifas | sum(attribute='vendidos')) if rifas else 0 %}
    {% set restantes = (total - vendidos) if total else 0 %}
    {% set ingreso_estimado = (rifas | sum(attribute='valor_numero')) * vendidos if rifas else 0 %}

    <div class="col-12 col-sm-6 col-lg-3">
      <div class="card-stat">
        <div class="label">N√∫meros Totales</div>
        <div class="value">{{ total }}</div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-lg-3">
      <div class="card-stat">
        <div class="label">Vendidos</div>
        <div class="value">{{ vendidos }}</div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-lg-3">
      <div class="card-stat">
        <div class="label">Disponibles</div>
        <div class="value">{{ restantes }}</div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-lg-3">
      <div class="card-stat">
        <div class="label">Ingreso Estimado</div>
        <div class="value">$ {{ "{:,}".format(ingreso_estimado).replace(",", ".") }}</div>
      </div>
    </div>
  </div>

  <!-- Lista r√°pida de rifas -->
  <div class="glass p-3">
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-2">
      <h5 class="m-0">Tus Rifas</h5>
      <a class="btn btn-sm btn-amarillo" href="{{ url_for('ver_rifas') }}">Ver todas ‚Üí</a>
    </div>

    {% if rifas and rifas|length > 0 %}
    <div class="table-responsive">
      <table class="table table-dark table-borderless align-middle mb-0">
        <thead>
          <tr>
            <th>Rifa</th>
            <th>Valor N¬∫</th>
            <th>Total</th>
            <th>Vendidos</th>
            <th>Estado</th>
            <th>Link p√∫blico</th>
            <th class="text-end">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rifas %}
          <tr>
            <td class="fw-semibold text-truncate" style="max-width:220px">{{ r["nombre"] }}</td>
            <td>$ {{ "{:,}".format(r["valor_numero"]).replace(",", ".") }}</td>
            <td>{{ r["total"] }}</td>
            <td>{{ r["vendidos"] }}</td>
            <td>
              <span class="badge {% if r['estado']=='activa' %}bg-success{% else %}bg-secondary{% endif %}">
                {{ r["estado"]|capitalize }}
              </span>
            </td>
            <td class="small text-truncate" style="max-width:260px">
              {{ request.host_url.rstrip('/') }}/r/{{ r["link_publico"] }}
            </td>
            <td class="text-end">
              <a class="btn btn-sm btn-verde" target="_blank"
                 href="{{ url_for('rifa_publica', link_publico=r['link_publico']) }}">üåê Abrir</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <div class="text-secondary">A√∫n no tienes rifas. Crea la primera con el bot√≥n ‚Äú+ Crear Rifa‚Äù.</div>
    {% endif %}
  </div>

</div>
{% endblock %}