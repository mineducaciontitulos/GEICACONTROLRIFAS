{% extends "base.html" %}
{% block content %}
<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="m-0">üëë Panel del Superadmin</h2>
    <a class="btn btn-outline-light" href="{{ url_for('login') }}">‚Üê Ir a Login</a>
  </div>

  <!-- Form crear negocio -->
  <div class="glass p-4 mb-4 superadmin-panel">
    <h5 class="mb-3">‚ûï Crear nuevo negocio</h5>

    <!-- OJO: a√±adimos superadmin-grid para el layout responsivo -->
    <form method="POST"
          action="{{ url_for('superadmin_crear_negocio', token=token) }}"
          class="superadmin-grid">

      <div class="col-12 col-md-4">
        <label class="form-label">Nombre del negocio *</label>
        <input class="form-control" name="nombre_negocio" required placeholder="Barber√≠a Hollywood">
      </div>

      <div class="col-12 col-md-3">
        <label class="form-label">Correo admin *</label>
        <input type="email" class="form-control" name="correo" required placeholder="admin@demo.com">
      </div>

      <div class="col-12 col-md-2">
        <label class="form-label">Contrase√±a *</label>
        <input type="password" class="form-control" name="contrasena" required placeholder="123456" autocomplete="new-password">
      </div>

      <div class="col-12 col-md-3">
        <label class="form-label">Celular (WhatsApp)</label>
        <input class="form-control" name="celular" placeholder="3100000000">
      </div>

      <div class="col-12 col-md-4">
        <label class="form-label">Nombre del propietario *</label>
        <input class="form-control" name="nombre_propietario" required placeholder="Juan P√©rez">
      </div>

      <div class="col-12 col-md-3">
        <label class="form-label">Estado</label>
        <select class="form-select" name="estado">
          <option value="activo" selected>Activo</option>
          <option value="inactivo">Inactivo</option>
        </select>
      </div>

      <div class="col-12 col-md-4">
        <label class="form-label">Wompi Public Key</label>
        <input class="form-control" name="public_key_wompi" placeholder="pub_prod_xxx">
      </div>

      <div class="col-12 col-md-5">
        <label class="form-label">Wompi Private Key</label>
        <input class="form-control" name="private_key_wompi" placeholder="prv_prod_xxx">
      </div>

      <div class="col-12 col-md-5">
        <label class="form-label">Wompi Integrity Secret</label>
        <input class="form-control" name="integrity_secret_wompi" placeholder="integ_prod_xxx">
      </div>

      <!-- Campo largo a todo el ancho -->
      <div class="col-12 col-md-5 col-span-2">
        <label class="form-label">Checkout URL (opcional)</label>
        <input class="form-control" name="checkout_url_wompi" placeholder="https://checkout.wompi.co/p/">
      </div>

      <!-- Bot√≥n alineado (full width en m√≥vil) -->
      <div class="col-span-2 superadmin-actions mt-tight">
        <button class="btn btn-primary">üöÄ Registrar Negocio</button>
      </div>
    </form>
  </div>

  <!-- Tabla de negocios -->
  <div class="glass p-3">
    <h5 class="mb-3">Negocios Registrados</h5>
    <div class="table-responsive">
      <table class="table table-dark table-borderless align-middle mb-0">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Correo</th>
            <th>Celular</th>
            <th>Estado</th>
            <th>Rifas</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for n in negocios %}
          <tr>
            <td>{{ n["id"] }}</td>
            <td class="text-truncate">{{ n["nombre_negocio"] }}</td>
            <td class="text-truncate">{{ n["correo"] }}</td>
            <td>{{ n["celular"] or '‚Äî' }}</td>
            <td>
              <span class="badge {% if n['estado']=='activo' %}bg-success{% else %}bg-secondary{% endif %}">
                {{ n["estado"]|capitalize }}
              </span>
            </td>
            <td>{{ n["total_rifas"] or 0 }}</td>
            <td class="actions">
              <form method="POST" action="{{ url_for('superadmin_estado_negocio', token=token) }}" class="d-inline">
                <input type="hidden" name="negocio_id" value="{{ n['id'] }}">
                {% if n["estado"] == "activo" %}
                  <button class="btn btn-sm btn-outline-danger" name="accion" value="desactivar">‚õî Desactivar</button>
                {% else %}
                  <button class="btn btn-sm btn-outline-success" name="accion" value="activar">‚úÖ Activar</button>
                {% endif %}
              </form>
            </td>
          </tr>
          {% endfor %}
          {% if negocios|length == 0 %}
            <tr><td colspan="7" class="text-secondary">No hay negocios registrados.</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>

</div>
{% endblock %}